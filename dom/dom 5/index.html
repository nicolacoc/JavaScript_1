<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Esercitazione form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
          crossorigin="anonymous">

    <style>


    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>Esercitazione Form</h1>
    </header>
    <main>
        <div class="row">
            <div class="col">

                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Insert New Person</h5>
                        <form action="" method="get">
                            <label for="name" class="mb-1 form-label required-field">Name</label>
                            <input type="text" class="form-control" name="name" placeholder="Name" id="name" required>

                            <label for="age" class="mt-3 mb-1 form-label required-field">Age</label>
                            <input type="number" class="form-control" name="age" placeholder="Age" id="age" required>

                            <label for="city" class="mt-3 mb-1 form-label">City</label>
                            <input type="text" class="form-control" name="City" placeholder="City" id="city">

                            <button class="btn btn-primary mt-4" type="submit">Submit</button>

                        </form>
                    </div>
                </div>

                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Select Person for Birthday</h5>
                        <form method="get">
                            <select class="form-select" id="Birthday" aria-label="Birthday">
                                <option value="">--Please choose an option--</option>

                            </select>
                            <button class="btn btn-primary mt-4" type="submit">Submit</button>
                        </form>
                    </div>
                </div>

            </div>
            <div class="col">


                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Persons</h5>
                        <ul class="list-group" id="persons-list">


                        </ul>
                    </div>
                </div>


            </div>
        </div>
    </main>
    <footer>
        <p>Sono il Footer</p>
    </footer>
</div>


<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
        integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
        crossorigin="anonymous"></script>
<script>
    class Person {
        constructor(name, age, city = "") {
            this.name = name;
            this.age = age;
            this.city = city;
        }
    }

</script>
<script>

    const persons = {
        list: [
            new Person("klaus", 40),
            new Person("Walther", 45, "Hamburg"),
            new Person("Susi", 39, "Hamburg"),
            new Person("Antonio", 20, "Milano"),
        ],

        addItemToList: function (item) {
            this.list.push(item);
            document.dispatchEvent(new Event("updateList"));
        },

        Birthday: function (index) {
            if (index.length > 0) {
                this.list
                    .filter(p => p instanceof Person)
                    .sort((a, b) => a.age - b.age)
                    [index].age++;
                document.dispatchEvent(new Event("updateList"));
            }
    }
    }

    function populatePersonList(persons) {
        if (persons instanceof Array) {
            let sel = document.getElementById("persons-list");
            /*sel.innerHTML="";
            persons
                .filter(p => p instanceof Person)
                .sort((a, b) => a.age - b.age)
                .forEach((array) => {
                        let liElement = document.createElement("li");
                        liElement.setAttribute("class", "list-group-item d-flex")
                        sel.append(liElement);
                        let div1 = document.createElement("div");
                        div1.innerHTML = array.name + (array.city.length <= 0) ? "" : " (" + array.city + ")";
                        liElement.append(div1);
                        let div2 = document.createElement("div");
                        div2.setAttribute("class", "ms-auto");
                        div2.innerHTML = array.age + " years old";
                        liElement.append(div2);

                })*/

            sel.innerHTML = persons
                .filter(p => p instanceof Person)
                .sort((a, b) => a.age - b.age)
                .map((p) => {
                    let s = "";
                    s += '<li class="list-group-item d-flex">';
                    s += '<div>' + p.name;
                    s += (p.city.length > 0) ? ' (' + p.city + ')' : '';
                    s += '</div>'
                    s += '<div class="ms-auto">' + p.age + ' years old';
                    s += '</div>'
                    s += '</li>'

                    return s;
                })
                .join("");
        }

    }

    function PopulateOptions(persons) {
        if (persons instanceof Array) {
            let Select = document.forms.item(1).elements[0];
            let firstOption= [Select.children[0]];
            Select.innerHTML = "";
            let newPersons = persons
                .filter(p => p instanceof Person)
                .sort((a, b) => a.age - b.age)
                .map((array, index) => new Option(array.name, index.toString()));


            let x = firstOption.concat(newPersons);
            x.forEach((i)=>{
            Select.append(i);
            })


        }
    }

    populatePersonList(persons.list);
    PopulateOptions(persons.list);

</script>
<script>
    const personCreateForm = document.forms.item(0);
    personCreateForm.addEventListener("submit", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const form = e.target;
        const age = form.elements[1].value;
        const name = form.elements[0].value;
        const city = form.elements[2].value;
        // persons.push(new Person(name, age, city));
        persons.addItemToList(new Person(name, age, city))
        form.reset();
    })

    document.addEventListener("updateList", () => {
        populatePersonList(persons.list);
        PopulateOptions(persons.list);
    })

    const birthdayEvent = document.forms.item(1);

    birthdayEvent.addEventListener("submit", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const form = e.target;
        const SelectedPersons = form.elements[0].value;
        persons.Birthday(SelectedPersons);
        // persons.push(new Person(name, age, city));
        form.reset();
    })

</script>
</body>
</html>